/* Same color as Monokai background generated by Pygments */
$back_color: #272822;
/* Code block inner padding */
$pad: 0.5rem;

pre,
code,
kbd,
samp {
  font-family: 'Source Code Pro', var(--font-family-monospace);
}

.codehilite, .highlight {

  .filename {
    display: block;
    padding: $pad $pad 0 $pad;
    /* Same as Bootstrap's <pre> default value */
    font-size: 87.5%;
  }

  pre {
    padding-top: $pad;
    padding-bottom: $pad;
    color: inherit;

    code {
      /* Highlight whole lines */
      span.hll {
        display: block;
      }
    }
  }

  code {
    word-wrap: normal;
  }

}

.codehilite {
  pre {
    overflow: inherit;
    table-layout: fixed;
    width: 100%;
    white-space: pre-wrap;

    code {
      word-break: break-word;
    }

    span[id^="coderow-"] {
      display: table-row;
    }
  }

  span.hll {
    margin-left: (-$pad);
    padding-left: $pad;
  }
}

/* Reset Pygments default padding */
%reset-pygment-padding {
  padding-left: 0;
  padding-right: 0;
}

/* Prevents line numbers to be selected */
span.linenos {
  @extend %reset-pygment-padding;

  /* Same as Bootstrap's .user-select-none class */
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;

  /* Gutter's border separating numbers from code */
  box-shadow: -0.05rem 0 #6c757d inset;

  background-color: $back_color;
  color: var(--secondary);
  word-break: normal;

  &.special {
    @extend %reset-pygment-padding;

    /* Highlight every every Nth line number in the gutter */
    background-clip: padding-box;
    background-color: var(--secondary);
  }

  .codehilite & {
    /* Prevents the long lines to wrap below the line number gitter on the left */
    display: table-cell;
    /* Simulates right margin, which has no effect on table cells */
    border-right: $pad solid transparent;
    padding: 0 $pad;
  }

  .highlight & {
    /* Makes the left-side line number gutter sticky */
    position: sticky;
    float: left;
    left: (-$pad);
    padding: 0 0 0 $pad*2;
    margin-left: (-$pad);
    margin-right: $pad;
  }
}

.highlight {

  /* Display line numbers with PyMdown Extensions' syntax:
   * https://facelessuser.github.io/pymdown-extensions/extensions/highlight/#line-number-styles
   * */
  [data-linenos]::before {
    content: attr(data-linenos);
  }

  /* Disable global Bootstrap box-sizing value locally. See:
   * https://github.com/twbs/bootstrap/blob/v4-dev/site/content/docs/4.5/getting-started/introduction.md#box-sizing
   * https://stackoverflow.com/a/53746125
   * */
  &,
  *,
  *:before,
  *:after {
    -webkit-box-sizing: content-box !important;
    -moz-box-sizing: content-box !important;
    box-sizing: content-box !important;
  }

  pre {
    code {
      word-break: normal;
    }
  }

}
