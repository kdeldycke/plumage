{% extends "base.html" %}


{% block title %}
    Archives
{% endblock %}


{% block top_center %}
    <h1>
        <a href="{{ SITEURL }}/{{ ARCHIVES_SAVE_AS }}" rel="bookmark" title="Permalink to archives">Archives</a>
    </h1>
{% endblock %}


{% block content %}

    {# Compute the spanning years all articles covers #}
    {% set year_range = [] %}
    {% for year in range(dates[-1].date.year, dates[0].date.year + 1) %}

        {# Count article in current year #}
        {% set article_count = [] %}
        {% for article in dates %}
            {% if article.date.year == year %}
                {% if article_count.append(1) %}{% endif %}
            {% endif %}
        {% endfor %}

        {# Ignore empty years #}
        {% if article_count|length > 0 %}
            {% if year_range.append(year) %}{% endif %}
        {% endif %}

    {% endfor %}

    {# Reverse years in descending order #}
    {% set year_range = year_range[::-1] %}

    <div class="accordion" id="accordianArchives" role="tablist" aria-multiselectable="true">
        {% for year in year_range %}
            <div class="card">
                <div class="card-header" role="tab" id="heading{{ year }}">
                    <h4>
                        <button type="button" data-toggle="collapse"
                           data-target="#collapse{{ year }}"
                           class="btn btn-link btn-block text-left {% if not loop.first %}collapsed{% endif %}"
                           aria-expanded="{% if loop.first %}true{% else %}false{% endif %}"
                           aria-controls="collapse{{ year }}">
                            {{ year }}
                        </a>
                    </h4>
                </div>
                <div id="collapse{{ year }}"
                     class="collapse {% if loop.first %}show{% endif %}"
                     role="tabpanel" aria-labelledby="heading{{ year }}"
                     data-parent="#accordianArchives">
                    <div class="card-body">
                        {% set current_month = False %}
                        {% for article in dates %}
                            {% if article.date.year == year %}

                                {% if article.date.month != current_month %}
                                    {% set current_month = article.date.month %}
                                    {% if not loop.first %}
                                        {# Triggers lint error with curlylint.
                                        This is a bug, see:
                                        https://github.com/thibaudcolas/curlylint/issues/14 #}
                                        </dl>
                                    {% endif %}
                                    <dl class="dl-horizontal">
                                {% endif %}

                                <dt><abbr class="published" title="{{ article.date.isoformat() }}">{{ article.date.strftime('%b. %d') }}</abbr></dt>
                                <dd><a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a></dd>

                                {% if loop.last %}
                                    </dl>
                                {% endif %}

                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}
